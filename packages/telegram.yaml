################################################################
## package / telegram
##  telegram bot 'noisufnoc emoh' configs
################################################################

################################################
## customize
################################################

homeassistant:
  customize:
    ################################################
    ## node anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'telegram'

      automation: &automation
        initial_state: true

################################################
## telegram
################################################

# Example configuration.yaml entry for the Telegram Bot
telegram_bot:
  - platform: polling
    api_key: !secret telegram_api_key
    allowed_chat_ids:
      - !secret telegram_chat_id

# Example configuration.yaml entry for the notifier
notify:
  - name: noisufnoc_emoh
    platform: telegram
    chat_id: !secret telegram_chat_id

################################################
## group
################################################

group:
  telegram_bot:
    name: Telegram Bot - noisufnoc emoh
    control: hidden
    entities:
      - automation.telegram__bot_command__args_test
      - automation.telegram__bot_command__temprature
      - automation.telegram__bot_command__weather
      - automation.telegram__notification__ashley_is_home
      - automation.telegram__notification__mike_is_home
      - automation.telegram__notification__home_assistant_shutdown
      - automation.telegram__notification__home_assistant_startup
      - automation.telegram__notification__home_assistant_update

################################################
### automation
#################################################

# Bot Commands

automation:
  - alias: "Telegram - Bot Command - temprature"
    <<: *automation
    trigger:
      platform: event
      event_type: telegram_command
      event_data:
        command: "/temp"
    action:
      - service: telegram_bot.send_message
        data_template:
          target: '{{ trigger.event.data.user_id }}'
          message: "The average temprature in the house is currently {{ states.sensor.home_avg_temp.state }}Â°F"
          disable_notification: True


  - alias: "Telegram - Bot Command - weather"
    <<: *automation
    trigger:
      platform: event
      event_type: telegram_command
      event_data:
        command: "/weather"
    action:
      - service: telegram_bot.send_message
        data_template:
          target: '{{ trigger.event.data.user_id }}'
          message: '{{ states.sensor.dark_sky_hourly_summary.state }}'
          disable_notification: True


  - alias: "Telegram - Bot Command - args test"
    <<: *automation
    trigger:
      platform: event
      event_type: telegram_command
      event_data:
        command: '/test'
        args:
          - 'arg'
    action:
      - service: telegram_bot.send_message
        data_template:
          target: '{{ trigger.event.data.user_id }}'
          message: 'You tested the command with an arg!'
          disable_notification: True

# Notifications
# Emojii Unicode - https://apps.timwhitlock.info/emoji/tables/unicode

  - alias: 'Telegram - Notification - Ashley is home'
    <<: *automation
    trigger:
        platform: state
        entity_id: device_tracker.ashley_pixel
        from: not_home
        to: home
    action:
      - service: notify.noisufnoc_emoh
        data:
          message: "Ashley is home! \ud83d\ude0d"
 
  - alias: 'Telegram - Notification - Mike is home'
    <<: *automation
    trigger:
        platform: state
        entity_id: device_tracker.mike_taimen
        from: not_home
        to: home
    action:
      - service: notify.noisufnoc_emoh
        data:
          message: "Mike is home, yay!"

  - alias: 'Telegram - Notification - Home Assistant Startup'
    <<: *automation
    trigger:
      - platform: homeassistant
        event: start
    action:
      service: notify.noisufnoc_emoh
      data:
        message: "Home Assistant Started"

  - alias: 'Telegram - Notification - Home Assistant Shutdown' 
    <<: *automation
    trigger:
      - platform: homeassistant
        event: shutdown
    action:
      service: notify.noisufnoc_emoh
      data:
        message: "Home Assistant Shutdown"

  - alias: 'Telegram - Notification - Home Assistant Update'
    <<: *automation
    trigger:
      - platform: state
        entity_id: updater.updater
    action:
      service: notify.noisufnoc_emoh
      data_template: 
        message: "Home Assistant {{ states.updater.updater.state }} is now available."
